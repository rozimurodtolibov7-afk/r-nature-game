<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Nature: Forest Defender</title>
    <style>
        :root { --forest: #1b5e20; --fire: #ff3d00; --water: #29b6f6; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; color: white; touch-action: none; }
        
        #game-canvas { display: block; background: linear-gradient(to bottom, #002171, #1b5e20); }

        #ui { position: fixed; top: 20px; width: 100%; display: flex; justify-content: space-around; pointer-events: none; z-index: 10; }
        .stat-box { background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 15px; border: 1px solid var(--water); font-weight: bold; }

        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        button { padding: 15px 40px; font-size: 20px; border: none; border-radius: 30px; background: var(--water); color: white; cursor: pointer; font-weight: bold; margin-top: 20px; text-transform: uppercase; }
        
        .fire-alert { position: fixed; bottom: 20px; width: 100%; text-align: center; color: var(--fire); font-weight: bold; animation: blink 0.5s infinite; display: none; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-box">ðŸŒ² HEALTH: <span id="health">100</span>%</div>
    <div class="stat-box">ðŸ’Ž RC: <span id="rc">0</span></div>
</div>

<div id="overlay">
    <h1 style="font-size: 40px; color: #4caf50;">FOREST DEFENDER</h1>
    <p>Tap to shoot water balls and extinguish falling fireballs!<br>Protect the nature!</p>
    <button id="start-btn">Start Defense</button>
</div>

<div class="fire-alert" id="alert">WARNING: FOREST ON FIRE!</div>

<canvas id="game-canvas"></canvas>

<script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('start-btn');
    const overlay = document.getElementById('overlay');

    let gameActive = false;
    let health = 100;
    let rc = 0;
    let fires = [];
    let bullets = [];
    let playerX = 0;

    // Audio System (Synthesized Music - No external links needed)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playBGM() {
        const loop = () => {
            if(!gameActive) return;
            let osc = audioCtx.createOscillator();
            let gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(110, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 2);
            osc.start(); osc.stop(audioCtx.currentTime + 2);
            setTimeout(loop, 2000);
        };
        loop();
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        playerX = canvas.width / 2;
    }
    window.addEventListener('resize', resize);
    resize();

    function shoot(e) {
        if(!gameActive) return;
        const x = e.touches ? e.touches[0].clientX : e.clientX;
        playerX = x;
        bullets.push({ x: playerX, y: canvas.height - 50, speed: 7 });
        
        // Sound effect
        let osc = audioCtx.createOscillator();
        let gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.value = 800;
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
        osc.stop(audioCtx.currentTime + 0.1);
    }

    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); shoot(e); });
    canvas.addEventListener('mousedown', shoot);

    function startGame() {
        overlay.style.display = 'none';
        gameActive = true;
        health = 100;
        rc = 0;
        fires = [];
        bullets = [];
        playBGM();
        update();
    }

    function update() {
        if(!gameActive) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Player
        ctx.font = '40px Arial';
        ctx.fillText('ðŸ¹', playerX - 20, canvas.height - 20);

        // Bullets
        bullets.forEach((b, bi) => {
            b.y -= b.speed;
            ctx.fillStyle = '#29b6f6';
            ctx.beginPath();
            ctx.arc(b.x, b.y, 8, 0, Math.PI*2);
            ctx.fill();
            if(b.y < 0) bullets.splice(bi, 1);
        });

        // Fireballs
        if(Math.random() < 0.03) {
            fires.push({ x: Math.random() * canvas.width, y: -50, speed: 2 + (rc/500) });
        }

        fires.forEach((f, fi) => {
            f.y += f.speed;
            ctx.fillText('ðŸ”¥', f.x - 15, f.y);

            // Collision
            bullets.forEach((b, bi) => {
                let dist = Math.hypot(f.x - b.x, f.y - b.y);
                if(dist < 30) {
                    fires.splice(fi, 1);
                    bullets.splice(bi, 1);
                    rc += 5;
                    document.getElementById('rc').innerText = rc;
                }
            });

            if(f.y > canvas.height) {
                fires.splice(fi, 1);
                health -= 10;
                document.getElementById('health').innerText = health;
                if(health <= 0) gameOver();
            }
        });

        requestAnimationFrame(update);
    }

    function gameOver() {
        gameActive = false;
        alert("FOREST DESTROYED! Mission Failed. RC: " + rc);
        location.reload();
    }

    startBtn.onclick = () => {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        startGame();
    };
</script>
</body>
</html>