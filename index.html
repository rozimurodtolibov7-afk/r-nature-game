<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Nature: Ultimate Titan</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --sky: #4facfe; --grass: #2ecc71; --dark-green: #27ae60;
            --gold: #f1c40f; --white: #ffffff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial Rounded MT Bold', sans-serif; }
        body { width: 100vw; height: 100vh; overflow: hidden; background: var(--sky); }

        /* CARTOON BACKGROUND */
        .world { position: relative; width: 100%; height: 100%; }
        .sun { position: absolute; top: 30px; right: 30px; font-size: 60px; filter: drop-shadow(0 0 20px yellow); animation: rotateSun 10s linear infinite; }
        @keyframes rotateSun { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .clouds { position: absolute; width: 100%; height: 30%; }
        .cloud { position: absolute; background: white; border-radius: 50px; width: 120px; height: 40px; opacity: 0.8; animation: moveCloud 25s infinite linear; }
        @keyframes moveCloud { from { left: -150px; } to { left: 110%; } }

        .meadow { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, #7cfc00, #2ecc71); border-top: 12px solid #1e8449; border-radius: 60% 60% 0 0 / 30px 30px 0 0; z-index: 1; }

        /* SCREENS */
        .screen { position: fixed; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; background: var(--sky); }
        .active { display: flex; }
        #scr-menu { background: url('https://img.freepik.com/free-vector/spring-landscape-scene_23-2148852379.jpg') center/cover; }

        /* HUD STATS */
        .hud { position: absolute; top: 15px; width: 94%; left: 3%; display: flex; justify-content: space-between; z-index: 2000; }
        .stat-card { background: white; padding: 8px 18px; border-radius: 20px; border: 4px solid var(--dark-green); font-weight: bold; font-size: 18px; box-shadow: 0 4px 0 var(--dark-green); display: flex; align-items: center; gap: 8px; }

        /* BUTTONS */
        .btn-main { background: white; border: 4px solid var(--dark-green); padding: 15px 40px; border-radius: 50px; font-size: 20px; color: var(--dark-green); font-weight: 900; cursor: pointer; box-shadow: 0 8px 0 var(--dark-green); margin: 10px; transition: 0.1s; }
        .btn-main:active { transform: translateY(4px); box-shadow: 0 4px 0 var(--dark-green); }
        .play-btn { width: 150px; height: 150px; border-radius: 50%; background: var(--gold); border: 8px solid white; font-size: 35px; color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

        /* SHOP MODAL */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 3000; align-items: center; justify-content: center; }
        .modal-content { width: 92%; height: 85%; background: #f0f0f0; border-radius: 35px; border: 6px solid var(--dark-green); overflow: hidden; display: flex; flex-direction: column; }
        .shop-tabs { display: flex; background: var(--dark-green); }
        .tab { flex: 1; padding: 15px; text-align: center; color: white; font-weight: bold; cursor: pointer; border-bottom: 5px solid transparent; }
        .tab.active-tab { background: white; color: var(--dark-green); border-bottom: 5px solid var(--gold); }
        .shop-grid { flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; }
        .item-card { background: white; border-radius: 20px; padding: 15px; text-align: center; border-bottom: 5px solid #ddd; position: relative; }
        .item-card img { width: 50px; }

        /* ACTION DOCK */
        .dock { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 15px; z-index: 2500; }
        .dock-btn { width: 70px; height: 70px; border-radius: 20px; border: 4px solid white; font-size: 32px; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 0 #ddd; }
        
        /* ENTITIES */
        .plant { position: absolute; transform: translate(-50%, -100%); z-index: 10; font-size: 55px; cursor: pointer; animation: grow 0.5s ease-out; }
        @keyframes grow { from { transform: translate(-50%, -100%) scale(0); } to { transform: translate(-50%, -100%) scale(1); } }
        .fox { position: absolute; font-size: 60px; z-index: 20; transition: 5s linear; bottom: 150px; }
    </style>
</head>
<body>

<div class="world">
    <div class="sun">‚òÄÔ∏è</div>
    <div class="clouds">
        <div class="cloud" style="top:10%; animation-delay:0s;"></div>
        <div class="cloud" style="top:25%; animation-delay:5s; width:160px;"></div>
    </div>
    <div class="meadow" id="garden-click-area"></div>

    <div id="scr-menu" class="screen active">
        <h1 style="color:white; font-size: 50px; text-shadow: 5px 5px var(--dark-green); margin-bottom: 30px;">R-NATURE</h1>
        <div class="play-btn" onclick="openGardens()">PLAY</div>
        <button class="btn-main" onclick="openRating()">üèÜ REYTING</button>
        <button class="btn-main" onclick="openLang()">üåê TIL TANLASH</button>
    </div>

    <div id="scr-gardens" class="screen">
        <div class="modal-content" style="height: 60%; width: 85%;">
            <h2 style="padding: 20px; text-align: center; background: var(--dark-green); color: white;">BOG'LARIM</h2>
            <div id="garden-list" style="flex:1; overflow-y:auto; padding: 15px;"></div>
            <button class="btn-main" onclick="buyNewGarden()">+ YANGI BOG' (1000 RC)</button>
            <button class="btn-main" style="background: #e74c3c; color: white;" onclick="backToMenu()">ORQAGA</button>
        </div>
    </div>

    <div id="scr-game" class="screen">
        <div class="hud">
            <div class="stat-card">üí∞ <span id="rc-val">0</span></div>
            <div class="stat-card">üì¶ <span id="fruit-val">0</span></div>
            <div class="stat-card" style="cursor:pointer;" onclick="openGardens()">üè° BOG'</div>
        </div>
        
        <div id="game-entities" style="width:100%; height:100%; position:relative; pointer-events: none;"></div>

        <div class="dock">
            <button class="dock-btn" style="background:#4caf50" onclick="openShop()">üõí</button>
            <button class="dock-btn" style="background:#f44336" onclick="shootFox()">üöÄ</button>
            <button class="dock-btn" style="background:#ff9800" onclick="getBonus()">üéÅ</button>
            <button class="dock-btn" style="background:#2196f3" onclick="rain()">üåßÔ∏è</button>
        </div>
    </div>
</div>

<div id="modal-shop" class="modal">
    <div class="modal-content">
        <div class="shop-tabs">
            <div class="tab active-tab" onclick="switchTab('seeds', this)">URUG'LAR</div>
            <div class="tab" onclick="switchTab('toys', this)">O'YINCHOQ</div>
            <div class="tab" onclick="switchTab('vip', this)">VIP</div>
        </div>
        <div id="shop-grid" class="shop-grid"></div>
        <button class="btn-main" style="margin:0; border-radius:0; background:#333; color:white;" onclick="closeShop()">YOPISH</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // GAME DATABASE
    const DB = {
        seeds: [
            {id:'s1', n:'Olma', p:50, i:'üçé'}, {id:'s2', n:'Nok', p:80, i:'üçê'}, 
            {id:'s3', n:'Gilos', p:120, i:'üçí'}, {id:'s4', n:'Shaftoli', p:200, i:'üçë'}
        ],
        toys: [
            {id:'t1', n:'Qizil Shar', p:30, i:'üî¥'}, {id:'t2', n:'Ko\'k Shar', p:30, i:'üîµ'},
            {id:'t3', n:'Yulduz', p:100, i:'‚≠ê'}, {id:'t4', n:'Kamalak', p:500, i:'üåà'}
        ],
        vip: [
            {id:'v1', n:'Archa', p:1000, i:'üéÑ'}, {id:'v2', n:'Robot', p:10000, i:'ü§ñ'}
        ]
    };

    let user = { 
        rc: 500, fruits: 0, 
        gardens: [{name: "Asosiy Bog'", plants: []}], 
        inv: [], currentG: 0 
    };

    function updateUI() {
        document.getElementById('rc-val').innerText = user.rc;
        document.getElementById('fruit-val').innerText = user.fruits;
    }

    // NAVIGATION
    function openGardens() {
        showScreen('scr-gardens');
        const list = document.getElementById('garden-list');
        list.innerHTML = '';
        user.gardens.forEach((g, i) => {
            list.innerHTML += `
                <div class="stat-card" style="margin-bottom:10px; justify-content:space-between; pointer-events:auto;">
                    <span>${g.name}</span>
                    <button class="btn-main" style="padding:5px 15px; margin:0; font-size:14px;" onclick="enterGarden(${i})">KIRISH</button>
                </div>`;
        });
    }

    function buyNewGarden() {
        if(user.rc >= 1000) {
            user.rc -= 1000;
            user.gardens.push({name: "Bog' #" + (user.gardens.length+1), plants: []});
            openGardens(); updateUI();
        } else tg.showAlert("RC yetarli emas!");
    }

    function enterGarden(i) {
        user.currentG = i;
        showScreen('scr-game');
        renderPlants();
    }

    // GAMEPLAY
    function renderPlants() {
        const layer = document.getElementById('game-entities');
        layer.innerHTML = '';
        const g = user.gardens[user.currentG];
        g.plants.forEach((p, idx) => {
            const div = document.createElement('div');
            div.className = 'plant'; div.style.left = p.x + 'px'; div.style.top = p.y + 'px';
            div.style.pointerEvents = 'auto';
            const grown = (Date.now() - p.t) > 5000;
            div.innerText = grown ? p.i : 'üå±';
            if(grown) {
                div.onclick = (e) => {
                    e.stopPropagation(); user.rc += 15; user.fruits++;
                    g.plants.splice(idx, 1); renderPlants(); updateUI();
                };
            }
            layer.appendChild(div);
        });
    }

    document.getElementById('garden-click-area').onclick = (e) => {
        const seedIdx = user.inv.findIndex(x => x.id.startsWith('s'));
        if(seedIdx > -1) {
            const seed = user.inv[seedIdx]; user.inv.splice(seedIdx, 1);
            user.gardens[user.currentG].plants.push({x: e.clientX, y: e.clientY, t: Date.now(), i: seed.i});
            renderPlants();
        } else if(document.getElementById('scr-game').classList.contains('active')) {
            tg.showAlert("Avval shopdan urug' oling! üõí");
        }
    };

    // SHOP SYSTEM
    function openShop() {
        document.getElementById('modal-shop').style.display = 'flex';
        switchTab('seeds', document.querySelector('.tab'));
    }

    function switchTab(type, el) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active-tab'));
        el.classList.add('active-tab');
        const grid = document.getElementById('shop-grid');
        grid.innerHTML = '';
        DB[type].forEach(item => {
            grid.innerHTML += `
                <div class="item-card">
                    <div style="font-size:40px;">${item.i}</div>
                    <div style="font-weight:bold; margin:5px 0;">${item.n}</div>
                    <button class="btn-main" style="padding:5px 15px; font-size:12px; margin:0;" onclick="buyItem('${item.id}', '${type}')">${item.p} RC</button>
                </div>`;
        });
    }

    function buyItem(id, type) {
        const item = DB[type].find(x => x.id === id);
        if(user.rc >= item.p) {
            user.rc -= item.p; user.inv.push(item);
            updateUI(); tg.HapticFeedback.notificationOccurred('success');
        } else tg.showAlert("Pul yetarli emas!");
    }

    // EXTRA FEATURES
    function rain() {
        tg.showAlert("Yomg'ir! Har bir tomchi +2 RC! üíß");
        for(let i=0; i<20; i++) {
            setTimeout(() => {
                const drop = document.createElement('div');
                drop.innerHTML = 'üíß'; drop.style.position = 'absolute';
                drop.style.left = Math.random()*90 + '%'; drop.style.top = '-50px';
                drop.style.fontSize = '30px'; drop.style.transition = '2s linear';
                document.body.appendChild(drop);
                setTimeout(() => drop.style.top = '100vh', 100);
                drop.onclick = () => { user.rc += 2; updateUI(); drop.remove(); };
                setTimeout(() => drop.remove(), 2500);
            }, i * 300);
        }
    }

    let currentFox = null;
    function spawnFox() {
        if(currentFox || !document.getElementById('scr-game').classList.contains('active')) return;
        currentFox = document.createElement('div');
        currentFox.className = 'fox'; currentFox.innerText = 'ü¶ä';
        currentFox.style.left = '-100px'; document.body.appendChild(currentFox);
        setTimeout(() => currentFox.style.left = '110%', 100);
        setTimeout(() => { if(currentFox) { currentFox.remove(); currentFox = null; } }, 5100);
    }

    function shootFox() {
        if(currentFox) {
            currentFox.innerText = 'üí•'; user.rc += 50; updateUI();
            setTimeout(() => { currentFox.remove(); currentFox = null; }, 500);
            tg.showAlert("Tulkini urdingiz! +50 RC üöÄ");
        }
    }

    function getBonus() { user.rc += 100; updateUI(); tg.showAlert("Sandiqdan 100 RC chiqdi! üéÅ"); }
    function backToMenu() { showScreen('scr-menu'); }
    function closeShop() { document.getElementById('modal-shop').style.display = 'none'; }
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function openRating() { tg.showAlert("Reyting: 1. Siz (Eng boy!)"); }
    function openLang() { tg.showAlert("Til: O'zbekcha tanlandi!"); }

    setInterval(spawnFox, 15000);
    updateUI();
</script>
</body>
</html>