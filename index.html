<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Nature: Mandala Soul</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; touch-action: none; }
        #overlay { position: absolute; top: 20px; width: 100%; text-align: center; color: rgba(255,255,255,0.4); pointer-events: none; }
        #controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: center; gap: 20px; }
        .btn { padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; border-radius: 20px; font-size: 12px; transition: 0.3s; }
        .btn:hover { background: rgba(255,255,255,0.1); border-color: #fff; }
        canvas { display: block; filter: contrast(120%) brightness(110%); }
    </style>
</head>
<body>

<div id="overlay">
    <div style="font-size: 18px; letter-spacing: 5px;">SOUL MANDALA</div>
    <div id="info">Symmetry: 8 | Harmony: Active</div>
</div>

<div id="controls">
    <div class="btn" onclick="clearCanvas()">TOZALASH</div>
    <div class="btn" onclick="saveArt()">SAQLASH</div>
</div>

<canvas id="mandala"></canvas>

<script>
const canvas = document.getElementById('mandala');
const ctx = canvas.getContext('2d');
let drawing = false;
let segments = 8;
let hue = 150;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playTone(freq, vol) {
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    g.gain.setValueAtTime(vol, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 1);
    osc.connect(g); g.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 1);
}

function draw(e) {
    if (!drawing) return;
    if (audioCtx.state === 'suspended') audioCtx.resume();

    const x = e.clientX || e.touches[0].clientX;
    const y = e.clientY || e.touches[0].clientY;

    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;

    const relX = x - centerX;
    const relY = y - centerY;

    // Tezlikka asoslangan ovoz va rang
    const speed = Math.sqrt(e.movementX**2 + e.movementY**2) || 5;
    hue = (hue + 0.5) % 360;
    
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = `hsla(${hue}, 80%, 60%, 0.3)`;
    ctx.shadowBlur = 5;
    ctx.shadowColor = `hsl(${hue}, 80%, 60%)`;

    for (let i = 0; i < segments; i++) {
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate((i * 2 * Math.PI) / segments);
        
        ctx.beginPath();
        ctx.moveTo(relX, relY);
        ctx.lineTo(relX - (e.movementX || 0), relY - (e.movementY || 0));
        ctx.stroke();
        
        // Ko'zgu effekti
        ctx.scale(1, -1);
        ctx.beginPath();
        ctx.moveTo(relX, relY);
        ctx.lineTo(relX - (e.movementX || 0), relY - (e.movementY || 0));
        ctx.stroke();
        
        ctx.restore();
    }
    
    if(Math.random() < 0.1) playTone(200 + (hue * 2), 0.02);
}

function clearCanvas() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function saveArt() {
    const link = document.createElement('a');
    link.download = 'my-soul-mandala.png';
    link.href = canvas.toDataURL();
    link.click();
}

window.addEventListener('mousedown', () => drawing = true);
window.addEventListener('mouseup', () => drawing = false);
window.addEventListener('mousemove', draw);
window.addEventListener('touchstart', () => drawing = true);
window.addEventListener('touchend', () => drawing = false);
window.addEventListener('touchmove', draw);

clearCanvas();
</script>
</body>
</html>