<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Nature: Universe Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --p-green: #2ecc71; --mars: #e67e22; --space: #2c3e50; --gold: #f1c40f; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        
        body { background: var(--space); overflow: hidden; height: 100vh; color: white; }

        /* MULTI-WORLD BACKGROUNDS */
        .world-layer { position: absolute; inset: 0; transition: 1s ease-in-out; }
        .earth { background: linear-gradient(to bottom, #87ceeb 0%, #2ecc71 100%); }
        .mars { background: linear-gradient(to bottom, #d35400 0%, #e67e22 100%); display: none; }
        
        .sun { position: absolute; top: 30px; right: 30px; font-size: 60px; filter: drop-shadow(0 0 20px yellow); }
        .stars { position: absolute; width: 100%; height: 100%; background: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.3; }

        /* UI HUD */
        .hud { position: fixed; top: 10px; width: 95%; left: 2.5%; z-index: 1000; display: flex; flex-direction: column; gap: 8px; }
        .top-stats { display: flex; justify-content: space-between; }
        .glass-card { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 8px 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.3); font-weight: bold; }

        /* MARKET TICKER */
        .ticker { background: rgba(0,0,0,0.5); font-size: 12px; padding: 5px; border-radius: 5px; overflow: hidden; color: #0f0; }
        .ticker-move { display: inline-block; animation: ticker 20s linear infinite; white-space: nowrap; }
        @keyframes ticker { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        /* GAME OBJECTS */
        .entity { position: absolute; transform: translate(-50%, -100%); transition: 0.5s; cursor: pointer; }
        .fox-warrior { position: absolute; font-size: 50px; transition: 5s linear; z-index: 100; }
        .gun { position: absolute; bottom: 120px; right: 20px; font-size: 60px; transform-origin: center; z-index: 500; pointer-events: none; }

        /* STRUCTURES */
        .structure { position: absolute; bottom: 100px; font-size: 55px; cursor: pointer; text-align: center; }
        .factory { left: 20px; }
        .lab { left: 100px; }
        .market-hub { right: 100px; }

        /* SHOP SYSTEM */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; padding: 20px; }
        .shop-tabs { display: flex; gap: 5px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; background: #444; border: none; color: white; border-radius: 5px; }
        .tab-btn.active { background: var(--p-green); }
        .item-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; height: 70vh; overflow-y: auto; }
        .item-card { background: #fff; color: #333; padding: 10px; border-radius: 10px; text-align: center; font-size: 11px; }

        /* ACTION DOCK */
        .dock { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 12px; z-index: 1500; }
        .dock-btn { width: 65px; height: 65px; border-radius: 20px; border: 3px solid #fff; font-size: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="world-earth" class="world-layer earth">
        <div class="stars"></div>
        <div class="sun">â˜€ï¸</div>
        <div class="structure factory" onclick="processJuice()">ğŸ­<br><small style="font-size:10px">ZAVOD</small></div>
        <div class="structure lab" onclick="openLab()">ğŸ§ª<br><small style="font-size:10px">LAB</small></div>
        <div class="structure market-hub" onclick="openMarket()">ğŸ›ï¸<br><small style="font-size:10px">BIRJA</small></div>
        <div id="earth-canvas" style="width:100%; height:100%;"></div>
    </div>

    <div class="gun" id="main-gun">ğŸ”«</div>

    <div class="hud">
        <div class="top-stats">
            <div class="glass-card">ğŸ’° <span id="rc-bal">0</span> RC</div>
            <div class="glass-card">ğŸ›¸ Planet: <span id="planet-name">Earth</span></div>
            <div class="glass-card">ğŸ¥¤ <span id="juice-count">0</span></div>
        </div>
        <div class="ticker">
            <div class="ticker-move">ğŸš€ GALAXY NEWS: Mars juice price up by 20% | ğŸ›¡ï¸ Shield active | ğŸ¦Š Fox raid detected in Sector 7...</div>
        </div>
    </div>

    <div class="dock">
        <button class="dock-btn" style="background:#4caf50" onclick="toggleShop()">ğŸ›’</button>
        <button class="dock-btn" style="background:#f44336" onclick="fireRocket()">ğŸš€</button>
        <button class="dock-btn" style="background:#2196f3;" onclick="switchPlanet()">ğŸª</button>
        <button class="dock-btn" style="background:#ff9800" onclick="openInv()">ğŸ’</button>
    </div>

    <div id="shop-modal" class="modal">
        <div class="shop-tabs">
            <button class="tab-btn active" onclick="setTab('seeds')">Ko'chat</button>
            <button class="tab-btn" onclick="setTab('tools')">Asbob</button>
            <button class="tab-btn" onclick="setTab('vip')">VIP/Archa</button>
        </div>
        <div id="item-list" class="item-grid"></div>
        <button onclick="toggleShop()" style="width:100%; padding:15px; margin-top:10px; border-radius:10px; background:red; color:white;">YOPISH</button>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let u = {
        rc: 1000, juice: 0, fruits: 0, 
        inv: [], planet: 'Earth', 
        xp: 0, level: 1
    };

    // BARCHA OLDINGI VA YANGI ELEMENTLAR (100+ items logic)
    const ITEMS = {
        seeds: Array.from({length: 30}, (_, i) => ({ id: `s${i}`, n: `Daraxt v${i+1}`, p: 100+(i*50), i: ['ğŸ','ğŸ','ğŸŠ','ğŸ‹','ğŸ’','ğŸ‘','ğŸ¥‘','ğŸŒ³','ğŸŒ²','ğŸŒµ'][i%10] })),
        tools: [
            {id: 't1', n: 'Ketmon', p: 200, i: 'â›ï¸'},
            {id: 't2', n: 'Dron', p: 5000, i: 'ğŸš'},
            {id: 't3', n: 'Bomba', p: 1000, i: 'ğŸ’£'}
        ],
        vip: [
            {id: 'v1', n: 'Fermer Robot', p: 100000, i: 'ğŸ¤–'},
            {id: 'v2', n: 'Supermen', p: 100000, i: 'ğŸ¦¸'},
            {id: 'v3', n: 'Sehrli Daraxt', p: 100000, i: 'âœ¨'},
            {id: 'v4', n: 'Archa', p: 1000, i: 'ğŸ„'}
        ]
    };
    for(let i=0; i<70; i++) ITEMS.vip.push({id:`toy${i}`, n:`Bezak #${i}`, p:50+i, i:'ğŸ”®'});

    let currentTab = 'seeds';

    function init() {
        renderShop();
        setInterval(spawnFox, 12000);
        setInterval(() => { u.rc += u.level; updateUI(); }, 60000); // Passive income
        
        // Miltiq aylanishi (Fix)
        window.addEventListener('mousemove', (e) => {
            const gun = document.getElementById('main-gun');
            const rect = gun.getBoundingClientRect();
            const angle = Math.atan2(e.clientY - rect.top, e.clientX - rect.left);
            gun.style.transform = `rotate(${angle}rad)`;
        });
    }

    function updateUI() {
        document.getElementById('rc-bal').innerText = Math.floor(u.rc);
        document.getElementById('juice-count').innerText = u.juice;
        document.getElementById('planet-name').innerText = u.planet;
    }

    function renderShop() {
        const list = document.getElementById('item-list');
        list.innerHTML = '';
        ITEMS[currentTab].forEach(it => {
            list.innerHTML += `
                <div class="item-card">
                    <div style="font-size:30px">${it.i}</div>
                    <b>${it.n}</b><br>
                    <button onclick="buy('${it.id}')" style="background:green; color:white; border:none; padding:5px 10px; border-radius:5px; margin-top:5px;">${it.p} RC</button>
                </div>
            `;
        });
    }

    function buy(id) {
        let item = [...ITEMS.seeds, ...ITEMS.tools, ...ITEMS.vip].find(x => x.id === id);
        if(u.rc >= item.p) {
            u.rc -= item.p;
            u.inv.push(item);
            tg.HapticFeedback.notificationOccurred('success');
            updateUI();
        } else tg.showAlert("RC yetarli emas!");
    }

    // EKISH VA HOSIL TIZIMI
    document.getElementById('earth-canvas').onclick = (e) => {
        let seedIdx = u.inv.findIndex(x => ITEMS.seeds.some(s => s.id === x.id) || x.id === 'v4');
        if(seedIdx === -1) return;

        let seed = u.inv[seedIdx];
        u.inv.splice(seedIdx, 1);

        const p = document.createElement('div');
        p.className = 'entity';
        p.style.left = e.clientX + 'px';
        p.style.top = e.clientY + 'px';
        p.innerText = 'ğŸŒ±';
        document.getElementById('earth-canvas').appendChild(p);

        setTimeout(() => p.innerText = 'ğŸŒ¿', 4000);
        setTimeout(() => {
            p.innerText = seed.i;
            p.style.fontSize = '55px';
            const box = document.createElement('div');
            box.innerText = 'ğŸ“¦';
            box.style.fontSize = '20px';
            box.onclick = (ev) => {
                ev.stopPropagation();
                u.fruits++;
                tg.showAlert("Hosil yig'ildi! Zavodga boring.");
                box.style.display = 'none';
                setTimeout(() => box.style.display = 'block', 10000);
            };
            p.appendChild(box);
        }, 8000);
    };

    function processJuice() {
        if(u.fruits > 0) {
            u.fruits--; u.juice++; u.rc += 10;
            updateUI();
            tg.showAlert("Sharbat tayyorlandi! +10 RC ğŸ¥¤");
        } else tg.showAlert("Meva yo'q!");
    }

    function spawnFox() {
        const fox = document.createElement('div');
        fox.className = 'fox-warrior';
        fox.innerText = 'ğŸ¦Š';
        fox.style.left = '-100px';
        fox.style.top = Math.random()*50 + 30 + '%';
        document.body.appendChild(fox);

        setTimeout(() => fox.style.left = '110%', 100);
        
        fox.onclick = () => {
            u.rc += 5;
            fox.innerText = 'ğŸ’¥';
            tg.HapticFeedback.impactOccurred('heavy');
            setTimeout(() => fox.remove(), 500);
            updateUI();
        };
    }

    function fireRocket() {
        const nuke = document.createElement('div');
        nuke.style.position = 'fixed';
        nuke.style.inset = '0';
        nuke.style.background = 'white';
        nuke.style.zIndex = '3000';
        document.body.appendChild(nuke);
        
        document.querySelectorAll('.fox-warrior').forEach(f => f.click());
        setTimeout(() => nuke.remove(), 100);
    }

    function switchPlanet() {
        u.planet = u.planet === 'Earth' ? 'Mars' : 'Earth';
        const earth = document.getElementById('world-earth');
        if(u.planet === 'Mars') {
            earth.style.background = 'linear-gradient(to bottom, #d35400, #e67e22)';
            tg.showAlert("Marsga xush kelibsiz! Gravitatsiya past.");
        } else {
            earth.style.background = 'linear-gradient(to bottom, #87ceeb, #2ecc71)';
        }
        updateUI();
    }

    function toggleShop() {
        const m = document.getElementById('shop-modal');
        m.style.display = m.style.display === 'block' ? 'none' : 'block';
    }

    function setTab(t) {
        currentTab = t;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        renderShop();
    }

    init();
</script>
</body>
</html>