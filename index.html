<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Nature Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; overflow: hidden; background-color: #2ecc71; touch-action: manipulation; }
        #nature-world { width: 100vw; height: 100vh; position: relative; z-index: 1; }
        .top-panel { position: fixed; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; z-index: 1000; pointer-events: none; }
        .stat-box { background: rgba(0,0,0,0.8); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; pointer-events: auto; }
        #weather-bar { position: fixed; top: 60px; right: 10px; background: rgba(0, 0, 0, 0.7); padding: 8px 15px; border-radius: 20px; color: white; font-weight: bold; z-index: 1000; }
        .bottom-menu { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 2000; }
        .game-btn { padding: 15px; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 14px; min-width: 85px; pointer-events: auto; }
        .btn-gold { background: #f1c40f; color: #000; }
        .btn-blue { background: #3498db; color: #fff; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2c3e50; border: 3px solid #f1c40f; padding: 20px; border-radius: 15px; z-index: 3000; width: 85%; color: white; max-height: 70vh; overflow-y: auto; }
        .plant, .building { position: absolute; font-size: 35px; transform: translate(-50%, -50%); pointer-events: none; z-index: 5; }
        #bonus-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #11998e, #38ef7d); padding: 30px; border-radius: 25px; z-index: 4000; text-align: center; color: white; }
    </style>
</head>
<body>
    <div class="top-panel">
        <div class="stat-box">ğŸ’° <span id="balance">10.00</span> RC</div>
        <div class="stat-box">ğŸŒ± <span id="seed-count">5</span></div>
    </div>
    <div id="weather-bar">â˜€ï¸ <span id="season-name">Bahor</span> | <span id="temperature">22Â°C</span></div>
    <div id="nature-world"></div>
    <div class="bottom-menu">
        <button class="game-btn btn-gold" onclick="openLeaderboard()">ğŸ† Rank</button>
        <button class="game-btn btn-blue" onclick="openShop()">ğŸ›’ Do'kon</button>
        <button class="game-btn btn-gold" onclick="openInvite()">ğŸ‘¥ Taklif</button>
    </div>

    <div id="shop-modal" class="modal">
        <h2 style="text-align:center;">R-Nature Shop</h2>
        <div id="shop-items-container">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>ğŸŒ¸ 10x Urug'</span> <button onclick="buyItem('seeds', 1.0)" style="background:#27ae60; color:#fff; border:none; padding:10px; border-radius:8px;">1.0 RC</button>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <span>ğŸ  Kichik Uy</span> <button onclick="buyItem('house', 5.0)" style="background:#27ae60; color:#fff; border:none; padding:10px; border-radius:8px;">5.0 RC</button>
            </div>
        </div>
        <button onclick="closeModal('shop-modal')" style="width:100%; padding:10px; background:#e74c3c; color:white; border:none; border-radius:10px; margin-top:15px;">Yopish</button>
    </div>

    <div id="bonus-modal">
        <h2>Bonus! ğŸ</h2>
        <p>5 ta Urug' va 1.00 RCoin berildi!</p>
        <button onclick="claimBonus()" style="padding:15px 30px; background:#fff; color:#11998e; border:none; border-radius:15px; font-weight:bold;">OK</button>
    </div>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        let inventory = { seeds: 5, rcoin: 10.00 };
        let plantedPlants = [];
        let currentSelection = 'seed';

        const world = document.getElementById('nature-world');
        // Telegram uchun teginish mantiqi
        world.addEventListener('touchstart', (e) => {
            if(e.target.id === 'nature-world') {
                const touch = e.touches[0];
                handleAction(touch.clientX, touch.clientY);
            }
        });

        function handleAction(x, y) {
            if (currentSelection === 'seed' && inventory.seeds > 0) {
                inventory.seeds--;
                const p = { x, y, id: Date.now() };
                plantedPlants.push(p);
                const el = document.createElement('div');
                el.className = 'plant';
                el.style.left = x + 'px'; el.style.top = y + 'px'; el.innerText = 'ğŸŒ±';
                world.appendChild(el);
                updateUI();
                setTimeout(() => el.innerText = 'ğŸŒ³', 5000);
                tg.HapticFeedback.impactOccurred('light');
            } else if (currentSelection === 'house') {
                const b = document.createElement('div');
                b.className = 'building';
                b.style.left = x + 'px'; b.style.top = y + 'px'; b.innerText = 'ğŸ ';
                world.appendChild(b);
                currentSelection = 'seed';
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function openShop() { document.getElementById('shop-modal').style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        function buyItem(type, price) {
            if (inventory.rcoin >= price) {
                inventory.rcoin -= price;
                if (type === 'seeds') inventory.seeds += 10;
                if (type === 'house') currentSelection = 'house';
                updateUI();
                tg.showAlert("Muvaffaqiyatli!");
            } else { tg.showAlert("Pul kam!"); }
        }

        function updateUI() {
            document.getElementById('balance').innerText = inventory.rcoin.toFixed(2);
            document.getElementById('seed-count').innerText = inventory.seeds;
        }

        function claimBonus() {
            inventory.seeds += 5; inventory.rcoin += 1.0;
            document.getElementById('bonus-modal').style.display = 'none';
            updateUI();
        }

        window.onload = () => {
            const last = localStorage.getItem('l_b');
            if (!last || (Date.now() - last) > 86400000) document.getElementById('bonus-modal').style.display = 'block';
            localStorage.setItem('l_b', Date.now());
            updateUI();
        };
    </script>
</body>
</html>