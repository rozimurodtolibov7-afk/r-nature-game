<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Nature Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; background-color: #1a1a1a; touch-action: manipulation; }
        
        /* Start Screen */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&fit=crop&w=1000&q=80');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;
        }
        .play-btn {
            padding: 20px 80px; font-size: 26px; font-weight: bold; color: white;
            background: #27ae60; border: none; border-radius: 50px; cursor: pointer;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4); animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        /* Game UI */
        #game-container { display: none; position: relative; width: 100vw; height: 100vh; background-color: #2ecc71; }
        .top-panel { position: fixed; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; z-index: 1000; pointer-events: none; }
        .stat-box { background: rgba(0,0,0,0.85); color: white; padding: 10px 18px; border-radius: 25px; font-weight: bold; pointer-events: auto; font-size: 14px; }
        
        .bottom-menu { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; z-index: 2000; width: 90%; justify-content: center; }
        .game-btn { flex: 1; padding: 15px 5px; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-size: 13px; color: #333; }
        .btn-gold { background: #f1c40f; }
        .btn-blue { background: #3498db; color: white; }

        /* Elements */
        .plant, .building { position: absolute; font-size: 38px; transform: translate(-50%, -50%); pointer-events: none; z-index: 10; transition: transform 0.3s; }
        
        /* Modals */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2c3e50; border: 3px solid #f1c40f; padding: 25px; border-radius: 20px; z-index: 5000; width: 80%; color: white; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .modal-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 12px; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color: white; font-size: 42px; letter-spacing: 5px; text-shadow: 3px 3px 15px rgba(0,0,0,0.8);">R-NATURE</h1>
        <p style="color: #eee; margin-bottom: 40px; font-style: italic;">O'z tabiyatingni yarat!</p>
        <button id="main-play-btn" class="play-btn">PLAY</button>
    </div>

    <div id="game-container">
        <div class="top-panel">
            <div class="stat-box">üí∞ <span id="balance">10.00</span> RC</div>
            <div class="stat-box">üå± <span id="seed-count">5</span></div>
        </div>

        <div id="nature-world" style="width: 100%; height: 100%;"></div>

        <div class="bottom-menu">
            <button class="game-btn btn-gold" onclick="showModal('rank-modal')">üèÜ Rank</button>
            <button class="game-btn btn-blue" onclick="showModal('shop-modal')">üõí Shop</button>
            <button class="game-btn btn-gold" onclick="showModal('invite-modal')">üë• Invite</button>
        </div>
    </div>
    <div id="shop-modal" class="modal">
        <h2 style="text-align:center; color: #f1c40f;">Shop</h2>
        <div class="modal-item">
            <span>üå∏ 10x Seeds</span> 
            <button onclick="buyItem('seeds', 1.0)" style="background:#27ae60; color:white; border:none; padding:8px 15px; border-radius:8px; font-weight:bold;">1.0 RC</button>
        </div>
        <div class="modal-item">
            <span>üè† Small House</span> 
            <button onclick="buyItem('house', 5.0)" style="background:#27ae60; color:white; border:none; padding:8px 15px; border-radius:8px; font-weight:bold;">5.0 RC</button>
        </div>
        <button onclick="hideModal('shop-modal')" style="width:100%; background:#e74c3c; color:white; border:none; padding:12px; border-radius:12px; margin-top:10px; font-weight:bold;">Close</button>
    </div>

    <div id="rank-modal" class="modal">
        <h2 style="text-align:center; color: #f1c40f;">Rankings</h2>
        <div style="text-align:center; font-size: 18px; margin: 20px 0;">
            <p>Sizning balansingiz:</p>
            <h1 style="color: #2ecc71;"><span id="rank-val">10.00</span> RC</h1>
        </div>
        <button onclick="hideModal('rank-modal')" style="width:100%; background:#e74c3c; color:white; border:none; padding:12px; border-radius:12px; font-weight:bold;">Close</button>
    </div>

    <div id="invite-modal" class="modal">
        <h2 style="text-align:center; color: #f1c40f;">Invite Friends</h2>
        <p style="text-align:center; opacity: 0.8;">Har bir do'stingiz uchun <br><b>+5.00 RCoin</b> bonus oling!</p>
        <button onclick="shareLink()" style="width:100%; background:#3498db; color:white; border:none; padding:18px; border-radius:15px; font-weight:bold; font-size: 16px;">Invite Telegram</button>
        <button onclick="hideModal('invite-modal')" style="width:100%; margin-top:10px; background:none; border:none; color:#95a5a6;">Later</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let gameData = { balance: 10.00, seeds: 5, items: [] };
        const world = document.getElementById('nature-world');
        let currentMode = 'seed';

        // PLAY tugmasini har xil hodisalar uchun sozlash
        const playBtn = document.getElementById('main-play-btn');
        const startAction = () => {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            loadGame();
            tg.HapticFeedback.impactOccurred('medium');
        };
        playBtn.addEventListener('click', startAction);
        playBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startAction(); });

        // Ekish mantiqi
        world.addEventListener('click', (e) => {
            if(e.target.id !== 'nature-world') return;
            if (currentMode === 'seed' && gameData.seeds > 0) {
                placeItem(e.clientX, e.clientY, 'seed');
            } else if (currentMode === 'house') {
                placeItem(e.clientX, e.clientY, 'house');
                currentMode = 'seed';
            }
        });

        function placeItem(x, y, type) {
            if(type === 'seed') gameData.seeds--;
            const item = { x, y, type, stage: type === 'seed' ? 'üå±' : 'üè†', id: Date.now() };
            gameData.items.push(item);
            renderItem(item);
            saveGame();
            updateUI();
            if(type === 'seed') setTimeout(() => { 
                item.stage = 'üå≥'; 
                const el = document.getElementById(item.id);
                if(el) el.innerText = 'üå≥';
                saveGame();
            }, 4000);
            tg.HapticFeedback.impactOccurred('light');
        }

        function renderItem(item) {
            const div = document.createElement('div');
            div.className = item.type === 'seed' ? 'plant' : 'building';
            div.id = item.id;
            div.style.left = item.x + 'px';
            div.style.top = item.y + 'px';
            div.innerText = item.stage;
            world.appendChild(div);
        }

        function buyItem(type, price) {
            if (gameData.balance >= price) {
                gameData.balance -= price;
                if (type === 'seeds') gameData.seeds += 10;
                if (type === 'house') currentMode = 'house';
                updateUI(); saveGame();
                tg.HapticFeedback.notificationOccurred('success');
            } else { tg.showAlert("RCoin yetarli emas!"); }
        }

        function updateUI() {
            document.getElementById('balance').innerText = gameData.balance.toFixed(2);
            document.getElementById('seed-count').innerText = gameData.seeds;
            document.getElementById('rank-val').innerText = gameData.balance.toFixed(2);
        }

        function saveGame() { localStorage.setItem('r_nature_v3', JSON.stringify(gameData)); }
        function loadGame() {
            const saved = localStorage.getItem('r_nature_v3');
            if (saved) {
                gameData = JSON.parse(saved);
                world.innerHTML = '';
                gameData.items.forEach(renderItem);
                updateUI();
            }
        }

        function showModal(id) { document.getElementById(id).style.display = 'block'; tg.HapticFeedback.impactOccurred('light'); }
        function hideModal(id) { document.getElementById(id).style.display = 'none'; }
        
        function shareLink() {
            const botUrl = "https://t.me/RPlayNatureBot"; // O'z botingiz silkasi
            tg.openTelegramLink(https://t.me/share/url?url=${encodeURIComponent(botUrl)}&text=Dunyodagi eng zo'r tabiatni men bilan qur! üå≥üí∞);
        }

        setInterval(() => {
            let trees = gameData.items.filter(i => i.stage === 'üå≥').length;
            if(trees > 0) { gameData.balance += (trees * 0.01); updateUI(); saveGame(); }
        }, 10000);
    </script>
</body>
</html>